---
- hosts: all
  vars:
    nginx_default_sslcert: '/tmp/wildcard.pem'
    nginx_default_sslkey: '/tmp/wildcard.key'
    nginx_enable_ipv6: true
    util_template_use_cow: false
    nginx_vhosts:
      - servername: nullsrv.example.com
        template: null.j2
      - servername: nullsrvwithkey.example.com
        template: null.j2
      - servername: actualserver.example.com
        upstreamserverproto: https
        upstreamserver: google.de
        sslcert: /tmp/testcert.pem
        sslkey: /tmp/testkey.key
      - servername: minimalproxy.example.com
        upstreamserver: google.com
  pre_tasks:
    - name: Copy testcerts
      with_items:
        - { name: 'testcert.pem', mode: '0644' }
        - { name: 'wildcard.pem', mode: '0644' }
        - { name: 'testkey.key', mode: '0600' }
        - { name: 'wildcard.key', mode: '0600' }
      become: true
      copy:
        src="{{ item.name }}"
        dest="/tmp/{{ item.name }}"
        owner=0
        group=0
        mode="{{ item.mode }}"
  roles:
    - { role: ansible-nginx }
